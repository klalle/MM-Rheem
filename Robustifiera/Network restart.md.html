<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/monokai.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/go.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<style>
	img { max-width:900px; }
	.codeblock { 
	background: #B0B0B0; padding:1px 10px 0px 10px; border-radius: 5px; overflow-x:auto; 
	}
	code {
 font-family: monospace; font-size: inherit; color: #4f4f4a !important;
	}
	.inlineCode {
 font-family: monospace; font-size: inherit; 
	}
</style>
</head>
<body style="background: #F0F0F0;">
<div style="margin: 0 auto; width:1380px;  position: relative;" >
<div style="width:1000px; padding:20px; margin:0px; z-index: 5; text-align:left; background-color: #DCDCDC; border-radius: 5px; position:absolute; top:0; left:340px;">
<h1>Network restart</h1>
<p>nätverksrestart vid strömavbrott</p>
<pre class="codeblock"><code style="tab-size: 4;" class="bash codeblock">bash
sudo nano /usr/local/bin/network-check.sh



#!/bin/bash

# En pålitlig extern adress att pinga. 8.8.8.8 är Googles DNS.
TARGET=8.8.8.8

# Skicka ett (1) ping-paket, med en timeout på 2 sekunder.
# Skicka all output till /dev/null eftersom vi bara bryr oss om returkoden.
ping -c 1 -W 2 $TARGET &gt; /dev/null 2&gt;&amp;1

# Kontrollera returkoden från ping-kommandot. 0 = lyckades, allt annat = misslyckades.
if [ $? -ne 0 ]; then
    # Om ping misslyckades, logga ett meddelande och starta om nätverkstjänsten.
    # logger-kommandot skriver till systemloggen (journalctl), vilket är bra för felsökning.
    logger -t network-check &quot;Nätverksfel upptäckt. Startar om nätverket...&quot;
    
    # *** VIKTIGT: Välj ETT av kommandona nedan ***
    # Avkommentera den rad som gäller för ditt system.
    #ta reda på vilken: 
    # systemctl is-active dhcpcd.service
    # systemctl is-active NetworkManager.service
    
    # För de flesta Raspberry Pi OS-installationer som använder dhcpcd:
    #systemctl restart dhcpcd.service
    
    # Om du använder NetworkManager (vanligare på andra Linux-distar):
    systemctl restart NetworkManager.service
    
else
    # Valfritt: Logga att allt är OK. Kan vara bra för att se att skriptet körs.
    # Du kan ta bort detta om du vill undvika &quot;spam&quot; i loggarna.
    logger -t network-check &quot;Nätverksanslutning är OK.&quot;
fi



sudo chmod +x /usr/local/bin/network-check.sh
</pre></code>
<p></p>
<p>skapa systemdtjänst:</p>
<pre class="codeblock"><code style="tab-size: 4;" class="bash codeblock">bash
sudo nano /etc/systemd/system/network-check.service


[Unit]
Description=Kontrollerar nätverksanslutning och startar om vid behov
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/network-check.sh

[Install]
WantedBy=multi-user.target
</pre></code>
<p></p>
<p>skapa systemd-timer</p>
<pre class="codeblock"><code style="tab-size: 4;" class="bash codeblock">bash
sudo nano /etc/systemd/system/network-check.timer

[Unit]
Description=Kör network-check.service var 5:e minut

[Timer]
# Kör 2 minuter efter uppstart för att ge routern en chans att starta först
OnBootSec=2min
# Kör därefter var 5:e minut
OnUnitActiveSec=5min
Unit=network-check.service

[Install]
WantedBy=timers.target
</pre></code>
<p></p>
<p>Starta om demonen</p>
<pre class="codeblock"><code style="tab-size: 4;" class="bash codeblock">bash
sudo systemctl daemon-reload
sudo systemctl enable network-check.timer
sudo systemctl start network-check.timer

#titta på listan med tajmrar + loggen
systemctl list-timers
journalctl -u network-check.service -f
</pre></code>
</div>
<div style="width:345px; padding-top: 20px;; position:absolute; top:0; left:0; overflow:auto;">
	<iframe src="../treeview.html" width="340px" frameBorder="0" height="900px"></iframe>
</div>
</div>
</body>
</html>
